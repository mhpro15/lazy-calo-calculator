// Prisma schema for Lazy Calo
// Stores scenarios/questions/options so you can add foods without shipping new code.

datasource db {
  provider  = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

enum FoodType {
  MEAL
  SNACK
  DRINK
}

enum RoastScope {
  DISH
  QUESTION
  OPTION
}

model Scenario {
  id        String            @id @default(cuid())
  slug      String            @unique
  title     String
  // Maps to a lucide icon on the client ("Pizza", "Hamburger", "Salad", "Coffee", "Utensils")
  iconKey   String
  foodType  FoodType
  keywords  ScenarioKeyword[]
  questions Question[]
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
}

model ScenarioKeyword {
  id         String   @id @default(cuid())
  scenarioId String
  value      String
  scenario   Scenario @relation(fields: [scenarioId], references: [id], onDelete: Cascade)

  @@unique([scenarioId, value])
  @@index([value])
}

model Question {
  id         String   @id @default(cuid())
  scenarioId String
  key        String
  text       String
  order      Int
  options    Option[]
  scenario   Scenario @relation(fields: [scenarioId], references: [id], onDelete: Cascade)

  @@unique([scenarioId, key])
  @@index([scenarioId, order])
}

model Option {
  id         String   @id @default(cuid())
  questionId String
  label      String
  value      Int
  order      Int
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@index([questionId, order])
}

model RoastLine {
  id          String      @id @default(cuid())
  scope       RoastScope
  foodType    FoodType?
  // For scope=DISH: match the dish input by substring (e.g. "pizza"). Null is the generic fallback.
  dishKey     String?
  // For scope=QUESTION/OPTION: question key (e.g. "drinkSugar", "slices")
  questionKey String?
  // For scope=OPTION: the exact option label (client uses questionKey|label lookup)
  optionLabel String?
  text        String
  order       Int
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([scope])
  @@index([foodType])
  @@index([questionKey])
  @@index([dishKey])
}
